---
layout: post
title: DHCP – 80/20?
date: '2010-06-17T23:24:00.000+02:00'
author: kaarol
tags:
- Klastry
- Oprogramowanie Serwerowe
- Windows Server 2kX
modified_time: '2015-03-03T21:16:55.560+01:00'
thumbnail: http://4.bp.blogspot.com/-Wb2YIn-vYSs/VPYU-yV32OI/AAAAAAAAAFM/YTJsS1p_da8/s72-c/dhcp_80_20.png
blogger_id: tag:blogger.com,1999:blog-1272990746006552071.post-5540803433316374295
blogger_orig_url: http://www.it-flow.pl/2010/06/dhcp-8020.html
---

Jak zwiększyć dostępność usługi DHCP w naszej sieci? Z pomocą przychodzą nam dwa rozwiązania:<br /><br />- reguła 80/20<br /><br />- klastrowanie usługi DHCP<br /><br /><strong>W przypadku klastra sprawa jest prosta:</strong><br /><ul><br /><li>instalujemy kilka węzłów przyszłego klastra</li><br /><li>tworzymy wspólny zasób na potrzeby klastra.</li><br /><li>tworzymy klaster dla usługi DHCP</li></ul><br />W przypadku reguły 80/20 konfiguracja jest trochę bardziej skomplikowana. Poniżej postaram się w kilku zdaniach opisać działanie i konfigurację tej reguły.<br /><br />80/20 w założeniu ma zwiększyć dostępność usługi DHCP w przypadku awarii jednego z serwerów. Ogólnie rzecz ujmując 80% niezarezerwowanych adresów jest przydzielana przez jeden serwer a reszta poprzez drugi.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Wb2YIn-vYSs/VPYU-yV32OI/AAAAAAAAAFM/YTJsS1p_da8/s1600/dhcp_80_20.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-Wb2YIn-vYSs/VPYU-yV32OI/AAAAAAAAAFM/YTJsS1p_da8/s1600/dhcp_80_20.png" /></a></div><br /><br /><br /><strong>Jakie korzyści niesie konfiguracja reguły 80/20?</strong><br /><br />Jak można szybko zauważyć w przypadku naszej konfiguracji cała reguła wymaga od nas poprawnej konfiguracji wykluczeń. Podczas działania obu serwerów reguła nie wnosi nic poza drobnym odciążeniem Serwera 1. Sytuacja zaczyna robić się ciekawa gdy awarii ulegnie serwer 1. Wtedy tylko 20% niezarezerwowane adresów może zostać przydzielonych z drugiego DHCP. Jeśli nasza sieć jest duża to 20% adresów bardzo często może pokryć tylko cześć pomieszczeń lub kilka pięter dużego budynku. Na szczęście po awarii lub celowym wyłączeniu serwera administrator może usunąć wykluczenie z drugiego serwera i tym samym udostępnić do dystrybucji wszystkie wolne adresy, które przynależą do skonfigurowanego zakresu. Jeśli serwer 1 zacznie znowu funkcjonować to administrator musi ponownie nałożyć nowe wykluczenie na drugim serwerze.<br /><br /><strong>Dlaczego cały czas mówisz o niezarezerwowany adresach, co z rezerwacjami?</strong><br /><br />W przypadku rezerwacji administrator jest zmuszony do utrzymania identycznych rezerwacji na obu serwerach. Tak jak pisałem w poprzednim <a href="http://it-flow.pl/?p=280">wpisie</a> o wykluczeniach, serwer DHCP na systemie Windows może rozdawać zarezerwowane adresy, które leżą w wykluczonej części. Tak więc administrator jest zmuszony to utrzymania spójnej listy rezerwacji. Dobrze jest napisać odpowiedni skrypt do tworzenia rezerwacji na obu serwerach.<br /><br /><strong>Kiedy nie trzeba usuwać wykluczenia?</strong><br /><br />Jeśli w naszym zakresie mamy 200 adresów a mniej niż czterdzieści jest przydzielanych bez rezerwacji to wtedy nie ma potrzeby usuwania wykluczenia.<br /><br /><strong>Czy muszę </strong><strong>ręcznie </strong><strong>usuwać </strong><strong> wykluczenia</strong><strong>? </strong><br /><br />Nie. Jeśli potrafisz napisać proste skrypty to np. za pomocą batch-a, vbscript-a, powershell-a da się napisać proste skrypty uruchamiane w harmonogramie zadań. Działanie skryptu ogranicza się do:<br /><ul><br /><li>Sprawdzenia czy serwer jest dostępny:</li><br /><li>Jeśli dodatkowy serwer jest niedostępny to usuwamy wykluczenie.</li><br /><li>Jeśli serwer jest dostępny to nakładamy wykluczenie na nadmiarowe adresy.</li></ul><br /><strong>Jak skonfigurować serwery?</strong><br /><ol><br /><li>Instalujemy na dwóch serwerach usługę DHCP</li><br /><li>Konfigurujemy na obu serwerach ten sam zakres adresów oraz niezbędne opcje</li><br /><li>Na pierwszym serwerze wykluczamy 20% końcowych adresów</li><br /><li>Na drugim serwerze wykluczamy 80% początkowych adresów.</li><br /><li>W razie potrzeby na obu serwerach wpisujemy te same rezerwacje.</li></ol><br /><strong>Skonfigurować klaster usługi DHCP czy wykorzystać regułę 80/20?</strong><br /><br />To zależy:&gt;<br /><br />Jeśli masz już w sieci zainstalowany klaster typu Failover i nie jest on zbyt mocno obciążony to można na nim skonfigurować usługę DHCP, która domyślnie będzie przetwarzana przez aktualnie niewykorzystywany węzeł.&nbsp; Jeśli nie posiadasz w sieci serwerów działających w klastrze FO to bardziej opłacalna będzie konfiguracja reguły 80/20. Usługa DHCP nie obciąża zbyt mocno systemu więc można ją uruchomić nawet na małej maszynie wirtualnej. Dodatkowo reguła 80/20 nie wymaga posiadania dostawowej przestrzeni dyskowej na kolejnym serwerze.