---

title: Usuwanie folderów domowych xD
date: '2010-10-04T02:07:00.000+02:00'
author: kaarol
tags:
- Windows Server 2kX
- Systemy operacyjne
- Windows 7
modified_time: '2015-02-23T23:51:46.117+01:00'
blogger_id: tag:blogger.com,1999:blog-1272990746006552071.post-7747532460467870028
blogger_orig_url: http://www.it-flow.pl/2010/10/usuwanie-folderow-domowych-xd.html
---

Jak co roku w wrześniowy wieczór trzeba się przemóc i przygotować nowy profil obowiązkowy dla użytkowników. Tak wiem, wiem “profile obowiązkowe to zło i powinno się tego unikać”. Ja niestety należę do osób co zawsze lubią iść pod górkę i jeśli jest dostępna fajna funkcjonalność to lubię z niej skorzystać. Może, żeby zbytnio nie przedłużać opiszę ciekawą sytuacje. Czyli jak wygenerować ciekawy problem i sprawdzić działanie mechanizmu poprzednich wersji lub kopii zapasowych.<a name='more'></a><br/><br/>Stan początkowy:<br/><ul><br/>	<li>Użytkownik ma skonfigurowany swój folder domowy/sieciowy, do którego ma pełne prawa.</li><br/>	<li>Użytkownik w właściwościach konta w AD ma podmapowany swój folder sieciowy (<a href="file://\\server\username\">\\server\username\</a>) jako dysk x:</li><br/>	<li>Na OU, w którym znajduje się użytkownik, została narzucona polisa przekierowująca folder <em>Moje Dokumenty(rys.1)</em> do folderu domowego. Dodatkowo zostaje włączona opcja przenoszenia zawartości aktualnego folderu do miejsca docelowego (rys.2). Screen poniżej:)<a href="http://it-flow.pl/wp-content/uploads/2010/10/image.png"><img style="display: inline; border: 0px;" title="image" src="http://it-flow.pl/wp-content/uploads/2010/10/image_thumb.png" border="0" alt="image" width="220" height="244" /></a> <a href="http://it-flow.pl/wp-content/uploads/2010/10/image1.png"><img style="display: inline; border: 0px;" title="image" src="http://it-flow.pl/wp-content/uploads/2010/10/image_thumb1.png" border="0" alt="image" width="221" height="244" /></a></li><br/>	<li>Użytkownicy korzystają z profilu obowiązkowego:)</li><br/></ul><br/>Teraz możemy w ciekawy sposób wyczyścić foldery użytkowników:)<br/><ol><br/>	<li>Uruchamiamy regedit, następnie za pomocą opcji “Load Hive” ładujemy sobie gałąź rejestru należącą do profilu obowiązkowego. Mówiąc w skrócie Load Hive –&gt; <a href="file://\\server\mandatory\ntuser.man">\\server\mandatory\ntuser.man</a>.</li><br/>	<li>W załadowanej gałęzi wyszukujemy klucze Personal (lokalizacja ..\SOFTWARE\Microsoft\Windows\CurrentVersion\Exploerer\Shell Folders i ..\SOFTWARE\Microsoft\Windows\CurrentVersion\Exploerer\User Shell Folders) i podmieniamy wartości na literę dysku sieciowego, na którą jest podmapowany folder domowy. W opisanym przypadku x:\.</li><br/>	<li>Zwalniamy załadowaną gałąź rejestru.</li><br/>	<li>Siadamy przy stacji lokalnej i logujemy się do systemu:) Po poprawnym zalogowaniu powinniśmy zobaczyć zmapowany dysk sieciowy ale nie będziemy mieli do niego dostępu. Po ponownym zalogowaniu dysk nie zostanie zamontowany.</li><br/></ol><br/><em>Ważne by użytkownik miał pełne prawa do swojego folderu sieciowego.</em><br/><br/><strong>Dlaczego folder został usunięty?? </strong><br/><br/>Podczas logowania system wczytuje plik ntuser.man a następnie z pomocą polisy rozpoczyna proces przekierowania folderu Moje dokumenty. Po przeniesieniu dokumentów z starej lokalizacji (dysk x: &lt;- wymusiliśmy to zmianą w ntuser.man) do nowej lokalizacji (<a href="file://\\server\username\">\\server\username\</a>) system rozpoczyna usunięcie niepotrzebnego folderu. Jak można zauważyć dysk x: i <a href="file://\\server\username\">\\server\username\</a> to jeden i ten sam folder.<br/><br/>Swoją drogą XP, w przeciwieństwie do W7, nie usuwał podanego folderu:)