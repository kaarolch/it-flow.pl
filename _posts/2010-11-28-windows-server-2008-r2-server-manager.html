---

title: Windows Server 2008 R2– Server Manager Error ??:/
date: '2010-11-28T21:48:00.000+01:00'
author: kaarol
tags:
- Oprogramowanie Serwerowe
- Windows Server 2kX
- Systemy operacyjne
modified_time: '2015-03-03T00:25:10.215+01:00'
blogger_id: tag:blogger.com,1999:blog-1272990746006552071.post-3806191775413503957
---

Jak to zwykle bywa w czwartek przed wyjściem z pracy włączyłem sobie uaktualnienia jednego z serwerów produkcyjnych, potrzebowałem dograć jedną łatkę a przy okazji poleciało trochę zaległości. Aktualizacja przeleciała błyskawicznie, restart serwera, 1/3, 2/3, 3/3, cofanie zmian. Godzina już późna 15.55 i nagle wysypały się uaktualnienia. Na szczęście system po restarcie uruchomił się poprawie, przynajmniej tak mi się wydawało. W piątek około 10 stwierdziłem, że doinstaluje pewną role, jednak ku mojemu zdziwieniu zobaczyłem biały ekran w zarządzaniu serwerem:/<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-4GycE5vKn_g/VPTxOobgxBI/AAAAAAAAAAs/tfk_dWLeKdc/s1600/roles_error.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-4GycE5vKn_g/VPTxOobgxBI/AAAAAAAAAAs/tfk_dWLeKdc/s1600/roles_error.png" height="252" width="320" /></a></div><a name='more'></a><br /><br />Sytuacja o tyle dziwna, że przed aktualizacją wszystko działo poprawnie. Od pewnego czasu, w takich sytuacjach, uwielbiam&nbsp; sprawdzać logi systemowe. W sumie szkoda, że często nie ma bezpośredniej informacji, który log muszę przeszukać. Na szczęście pomimo tego, że MS nie lubi się chwalić logami w komunikatach o błędach, często na technecie lub w dzienniku zdarzeń często gęsto można znaleźć odnośnik do właściwego pliku. W mojej sytuacji był to plik w<br /><br /><strong>%systemroot%\Logs\CBS\CBS.log. </strong>Aktualnie nie posiadam, przed sobą kopi tego logu jednak można z niego przeczytać dlaczego otrzymujemy błąd podczas server manager’a. W moim przypadku plik w/w logu nie do końca pozwolił mi uzyskać info o tym, która łatka popsuła pliki systemowe.<br /><br />Z pomocą przyszedł <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=c4b0f52c-d0e4-4c18-aa4b-93a477456336"><strong>System Update Readiness Tool for Windows Server 2008 R2 x64 Edition</strong></a><strong> – </strong>małe narzędzie pozwalające nam sprawdzić, które pliki usług są uszkodzone lub niewłaściwe (nowsze/starsze). Narzędzie działa dość prosto:<br /><ol><br /><li><br /><div>Po pobraniu próbuje się zainstalować w systemie tak jak zwykła łatka</div></li><br /><li><br /><div>Podczas instalacji tworzy log <em>c:\windows\logs\CBS\CheckSUR.log, </em>który wygląda mniej więcej tak:<br /><strong><em>Przykład:</em></strong></div><br />=================================<br />Checking System Update Readiness.<br />Binary Version 6.1.7600.20822<br />Package Version 10.0<br />2010-11-25 11:22<br /><br />Checking Windows Servicing Packages<br /><br />Checking Package Manifests and Catalogs<br />(f)&nbsp;&nbsp;&nbsp; CBS MUM Corrupt&nbsp;&nbsp;&nbsp; 0x00000000&nbsp;&nbsp;&nbsp; servicing\Packages\Package_for_KB981957_RTM~31bf3856ad364e35~amd64~~6.1.1.2.mum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Expected file name Microsoft-Windows-Foundation-Package~31bf3856ad364e35~amd64~~6.1.7600.16385.mum does not match the actual file name<br /><br />Checking Package Watchlist<br /><br />Checking Component Watchlist<br /><br />Checking Packages<br /><br />Checking Component Store<br />==================================</li><br /><li>Jeśli złapaliśmy info to anulujemy instalacje łatki RTools i możemy przystępować do naprawy.</li></ol><br /><strong>Przewróciło się niech leży czyli jak odkręcić ten cały bałagan: </strong><br /><br /><em><span style="text-decoration: underline;"><span style="color: black;">Drobna uwaga: przed przystąpieniem do jakiejkolwiek naprawy lepiej wykonaj backup. Za działanie poniższej procedury nie biorę odpowiedzialności. Tak więc jeśli coś pomylisz to lepiej miej kopie zapasową serwera </span></span></em><br /><ol><br /><li><br /><div><span style="color: black;">Dobra złapaliśmy log i co dalej. Jak pewnie zauważyłeś w pliku mamy informacje który z plików jest uszkodzony:<br />servicing\Packages\Package_for_<strong>KB981957</strong>_RTM~31bf3856ad364e35~amd64~~6.1.1.2.mum</span></div></li><br /><li><br /><div><span style="color: black;">Pogrubionym tekstem zaznaczyłem numer paczki, w której możemy znaleźć odpowiedni plik. Dlatego pierwsze co musimy zrobić to pobrać odpowiednią wersję aktualizacji z strony supportu MS. W moim przypadku musiałem pobrać&nbsp;&nbsp; <strong>KB981957 dla Windows Server 2008 R2 x64. </strong></span></div></li><br /><li><br /><div><span style="color: black;">Po pobraniu paczki, zamieniamy jej rozszerzenie z msu na cab., jeśli posiadacie na serwerze 7zipa można bez zmiany rozszerzenia wypakować paczkę do nowego katalogu. </span></div></li><br /><li><br /><div><span style="color: black;">Po rozpakowaniu paczki wyszukujemy plik: <em>Package_for_KB981957_RTM~31bf3856ad364e35~amd64~~6.1.1.2.mum </em></span></div></li><br /><li><br /><div><span style="color: black;">Przed podmianką pliku musimy najpierw zmienić właściciela i nadać naszemu kontu pełne prawa do oryginalnego pliku. </span></div></li><br /><li><br /><div><span style="color: black;">Po nadaniu uprawnień zmieniamy nazwę oryginalnego pliku – dobrze jest mieć kopię gdyby jednak podmianka pliku spowodowała niespodziewane błędy. </span></div></li><br /><li><br /><div><span style="color: black;">Następnie do katalogu c:\Windows\Servicing\Packages\ (*ten katalog też jest wypisany w logu Rtools) kopiujemy plik który wypakowaliśmy sobie z świeżo pobranej paczki. </span></div></li><br /><li><br /><div><span style="color: black;">Po skopiowaniu pliku zmieniamy jego właściciela na konto systemowe oraz dodajemy pełne uprawnienia dla NT SERVICE\TrustedInstaller. Uprawnienia dla TrustedInstaller powinny zostać odziedziczone z katalogu nadrzędnego. </span></div></li><br /><li><br /><div><span style="color: black;">Jeśli w logu CheckSUR.log było więcej wpisów to dla kolejnych plików postępujemy zgodnie z krokami 1-8. </span></div></li><br /><li><br /><div><span style="color: black;">Po podmienieniu wszystkich plików dobrze jest jeszcze raz uruchomić Readiness Tool by sprawdzić czy wprowadzone zmiany nie powodują konfliktów lub czy jakimś cudem nie wgraliśmy złych plików. </span></div></li><br /><li><br /><div><span style="color: black;">Jeśli kolejny log jest czysty to spokojnie możemy uruchomić server manager’a. </span></div></li></ol><br /><span style="color: black;">Cała procedura działa też na innych systemach Vista/7/2008. Także, jeśli widzisz dziwne błędy, które nie są opisane w żadnym KB to warto uruchomić <strong>System Update Readiness Tool.</strong></span>
