---

title: 'Cisco 1000v - vempkt  czyli zdalny wireshark. '
date: '2015-08-06T18:13:00.002+02:00'
author: kaarol
tags:
- Wireshark
- Nexus 1000v
- Cisco
modified_time: '2015-08-06T18:15:18.175+02:00'
blogger_id: tag:blogger.com,1999:blog-1272990746006552071.post-6626550809145932753
blogger_orig_url: http://www.it-flow.pl/2015/08/cisco-1000v-vempkt-czyli-zdalny.html
---

<div style="text-align: justify;">Kolejne przygody z wirtualnym switchem Nexus 1000v uświadamiają mnie, że Cisco coraz częściej zaczyna dodawać coraz to ciekawsze narzędzia do swoich produktów. Przykładem takiego narzędzia jest vempkt.&nbsp;</div><div style="text-align: justify;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://networkstatic.net/wp-content/uploads/2013/02/wireshark.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://networkstatic.net/wp-content/uploads/2013/02/wireshark.jpg" height="249" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">zapożyczone z&nbsp;http://networkstatic.net/</td></tr></tbody></table><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Narzędzie to jest dostarczane podczas instalacji moduły VEM na ESXi. Funkcjonalnością vempkt przypomina tcpdump lub według niektórych mechanizm sesji SPAN dostępnych na przełącznikach Cisco.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><i><b>Jak zacząć zabawę z vempkt?</b></i>&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Zakładając, że mamy skonfigurowany switch Nexus 1000v musimy jeszcze odblokować możliwość logowania się do ESXi za pomocą protokołu SSH (przykładowy opis: <a href="https://pubs.vmware.com/vsphere-50/index.jsp?topic=%2Fcom.vmware.vcli.migration.doc_50%2Fcos_upgrade_technote.1.4.html">dokumentacja vmware</a>).&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Po zalogowaniu się na hosta musimy zidentyfikować numer interfejsu, który chcemy podsłuchać (LTL - &nbsp;Local Target Logic) i numeru vlan, który nas interesuje.&nbsp;</div><div style="text-align: justify;">Przydatne komendy:&nbsp;</div><div style="text-align: justify;"></div><ul><li><b>vempkt show info - </b>listuje wszystkie LTL wraz z opisem maszyn, które są zarejestrowane na danym hoście oraz interfejsy nexusa lub portchannel</li><li><b>vemcmd show port vlans -</b>&nbsp;listuje porty wraz z numerami vlanów, które są przypisane</li></ul><br /><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Po skompletowaniu wszystkich niezębnych informacji na temat interfejsu, który nas interesuje możemy przystąpić do łapania ruchu:</div><div style="text-align: justify;"></div><ol><li><b>vempkt capture [ingress | egress | drop| all stages] ltl [id] vlan [nr] - </b>&nbsp;uwaga w niektórych wersjach vem, niezależnie od wybranego typu ruchu&nbsp;&nbsp;vempkt łapie ruch każdego typu (all stages).</li><li><b>vempkt show capture info - </b>&nbsp;wyświetla reguły filtra, który zdefiniowaliśmy w poprzednim kroku.</li><li><b>vempkt start - </b>&nbsp;uruchamiamy pluskwę</li><li><b>vempkt stop</b> - &nbsp;zatrzymujemy pluskwę;)</li><li><b>vempkt show info - </b>&nbsp;komenda przydaje się do wyświetlenia statystyk na temat zebranego ruchu.&nbsp;</li><li><b>vempkt pcap export file_name.pcap - </b>zapisujemy złapany ruch w formacie PCAP do pliku file_name.pcap, który potem możemy zaimportować do Wiresharka.&nbsp;</li><li><b>vempkt clear - </b>czyścimy zdefiniowane ustawienia. &nbsp;</li><li><b>scp root@esxi.ip:/root/file_name.pcap . - </b>&nbsp;zrzucamy pcap na lokalny komputer w celu dalszej analizy.&nbsp;</li></ol><div><i><b>Przypadki użycia?&nbsp;</b></i></div><div><ol><li>Weryfikacja czy ruch przechodzi przez reguły zdefiniowane na VSG&nbsp;</li><li>Złapanie ruchu na interfejsie wejściowym do ESXi</li><li>Analiza ruchu, który zostaje dostarczony do hosta &nbsp;bez potrzeby logowania się na docelową maszynę wirtualną.&nbsp;</li><li>Sprawdzenie czy ruch przechodzi przez sieć szkieletową mając dostęp tylko do serwerów ESXi ( głównie administratorzy VMware w dużych firmach)&nbsp;</li></ol><div><b><i>Drobne uwagi?&nbsp;</i></b></div></div><div><b><i><br /></i></b></div><div><ul><li>Jeśli chcemy przechwycić ruch wychodzący lub wchodzący do maszyny wirtualnej , która działa w klastrze VMware, &nbsp;musimy wiedzieć na którym hoście się ona znajduje.&nbsp;</li><li>Automatyczny DR może nam czasem popsuć łapanie ruchu:)</li><li>Czasem trzeba zwiększyć wielkość łapanego pakietu za pomocą <b>&nbsp;vempkt size [mtu size]</b></li><li>W celu szybkiej analizy pakiety można też zrzucić do pliku txt zamiast pcap: <b>vempkt display detail all &gt; name_file.txt</b></li></ul></div>