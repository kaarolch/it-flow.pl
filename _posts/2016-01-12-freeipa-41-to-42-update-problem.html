---

title: "[EN] FreeIPA 4.1 to 4.2 update problem"
date: '2016-01-12T21:14:00.003+01:00'
author: kaarol
tags:
- IPA
- CentOS
- FreeIPA 4.1
modified_time: '2016-01-16T14:15:54.441+01:00'
blogger_id: tag:blogger.com,1999:blog-1272990746006552071.post-9202463832178781090
---

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://fedoramagazine.org/wp-content/uploads/2014/12/freeipa-150x150.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://fedoramagazine.org/wp-content/uploads/2014/12/freeipa-150x150.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">pic. from fedoramagazine.org&nbsp;</td></tr></tbody></table><div style="text-align: justify;">On two machines with CentOS 7.2 I was using the FreeIPA 4.1.0 that should theoretically update to a newer version 4.2.0&nbsp;without any problem. The new version brings a few new feature, byt they should not generate any update issues.</div><div><div style="text-align: justify;">Steps in the<a href="http://www.freeipa.org/page/Upgrade"> documentation</a> for version 4.2 are quite easy:</div><div style="text-align: justify;"><b><br /></b></div><div style="text-align: center;"><span style="font-family: Courier New, Courier, monospace;"><b>yum update freeipa-server</b></span></div><div style="text-align: center;"></div><div style="text-align: justify;">&nbsp;<span style="font-family: inherit;">The&nbsp;</span>package<span style="font-family: inherit;">&nbsp;manager executed all&nbsp;</span>post-installation<span style="font-family: inherit;">&nbsp;upgrade scripts (in current version:&nbsp;</span><span style="background-color: white; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 20px; white-space: pre-wrap;"><b><i>ipa-server-upgrade</i></b></span><span style="background-color: white; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 20px; white-space: pre-wrap;">). </span><br /><span style="background-color: white; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 20px; white-space: pre-wrap;"></span><br /><a name='more'></a><span style="background-color: white; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 20px; white-space: pre-wrap;"><br /></span></div><div style="text-align: justify;"><span style="background-color: white; color: #333333; line-height: 20px; white-space: pre-wrap;"><span style="font-family: inherit;">In the</span></span><span style="background-color: white; color: #333333; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 20px; white-space: pre-wrap;"> </span><span style="color: #333333;"><span style="line-height: 20px; white-space: pre-wrap;"><span style="font-family: Monaco, Menlo, Consolas, Courier New, monospace; font-size: 13px;"><b><i>/var/log/ipaupgrade.log</i></b> </span><span style="font-family: inherit;">I did not found any interesting errors. All info looks ok:</span></span></span></div><div style="text-align: justify;"><span style="color: #333333;"><span style="line-height: 20px; white-space: pre-wrap;"><span style="font-family: inherit;"><br /></span></span></span></div><div style="text-align: justify;"><span style="color: #333333;"></span><br /><div style="font-family: 'Courier New', Courier, monospace; font-size: x-small; line-height: 20px; white-space: pre-wrap;"><span style="color: #333333;">2016-01-12T18:47:14Z INFO Upgrading the configuration of the IPA services 2016-01-12T18:47:14Z INFO [Verifying that root certificate is published] 2016-01-12T18:47:28Z INFO [Migrate CRL publish directory] 2016-01-12T18:47:28Z INFO CRL tree already moved 2016-01-12T18:47:28Z INFO [Verifying that CA proxy configuration is correct] 2016-01-12T18:47:36Z INFO [Verifying that KDC configuration is using ipa-kdb backend] 2016-01-12T18:47:37Z INFO [Fix DS schema file syntax] 2016-01-12T18:47:37Z INFO Syntax already fixed 2016-01-12T18:47:37Z INFO [Removing RA cert from DS NSS database] 2016-01-12T18:47:37Z INFO RA cert already removed 2016-01-12T18:47:38Z INFO [Enable sidgen and extdom plugins by default] 2016-01-12T18:47:40Z INFO [Updating mod_nss protocol versions] 2016-01-12T18:47:40Z INFO Protocol versions already updated 2016-01-12T18:47:40Z INFO [Fixing trust flags in /etc/httpd/alias] 2016-01-12T18:47:40Z INFO Trust flags already processed 2016-01-12T18:47:40Z INFO [Removing self-signed CA] 2016-01-12T18:47:40Z INFO [Checking for deprecated KDC configuration files] 2016-01-12T18:47:40Z INFO [Checking for deprecated backups of Samba configuration files] 2016-01-12T18:47:40Z INFO [Setting up Firefox extension] 2016-01-12T18:47:54Z INFO [Add missing CA DNS records] 2016-01-12T18:47:54Z INFO IPA CA DNS records already processed 2016-01-12T18:47:54Z INFO [Removing deprecated DNS configuration options] 2016-01-12T18:47:54Z INFO DNS is not configured 2016-01-12T18:47:54Z INFO [Ensuring minimal number of connections] 2016-01-12T18:47:54Z INFO DNS is not configured 2016-01-12T18:47:54Z INFO [Enabling serial autoincrement in DNS] 2016-01-12T18:47:54Z INFO DNS is not configured 2016-01-12T18:47:54Z INFO [Updating GSSAPI configuration in DNS] 2016-01-12T18:47:54Z INFO DNS is not configured 2016-01-12T18:47:54Z INFO [Updating pid-file configuration in DNS] 2016-01-12T18:47:54Z INFO DNS is not configured</span></div><span style="color: #333333;"></span><br /><div style="font-family: 'Courier New', Courier, monospace; font-size: x-small; line-height: 20px; white-space: pre-wrap;"><span style="color: #333333;"><br /></span></div><span style="color: #333333;"></span><div><span style="color: #333333;"><span style="font-family: inherit;"><span style="line-height: 20px; white-space: pre-wrap;">Unfortunately the IPA server did not start correctly. The service <b><i>named-pkcs11</i></b> </span></span><span style="line-height: 20px; white-space: pre-wrap;">responsible</span><span style="font-family: inherit;"><span style="line-height: 20px; white-space: pre-wrap;"> for DNSSEC could not correctly started and </span></span><span style="line-height: 20px; white-space: pre-wrap;">thrown error</span><span style="font-family: inherit;"><span style="line-height: 20px; white-space: pre-wrap;">:</span></span></span></div><span style="color: #333333;"><div><span style="font-family: inherit;"><span style="line-height: 20px; white-space: pre-wrap;"><br /></span></span></div></span><br /><div style="color: #333333;"><span style="background-color: white; font-size: x-small;"><span style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;">named-pkcs11</span><a class="missing changeset" href="https://www.blogger.com/null" style="color: #999988; font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;" title="Brak zmian 1826 w repozytorium">[1826]</a><span style="font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;">:</span><span style="color: black; font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;">ObjectStore.cpp(59): Failed to enumerate object store in /var/lib/softhsm/tokens/ <br />named-pkcs11</span><a class="missing changeset" href="https://www.blogger.com/null" style="color: #999988; font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;" title="Brak zmian 1826 w repozytorium">[1826]</a><span style="color: black; font-family: Verdana, Arial, 'Bitstream Vera Sans', Helvetica, sans-serif; text-align: start;">: SoftHSM.cpp(437): Could not load the object store</span></span></div><div style="color: #333333;"><span style="font-family: inherit;"><span style="line-height: 20px; white-space: pre-wrap;"><br /></span></span></div><div style="color: #333333;">In RH errata you can find a few info about broken install script, etc. All this hints did not solve my &nbsp; problem so I decided to run&nbsp;<i><b>ipa-dns-install</b></i> to check dns configuration. As you probably know in FreeIPA 4.2.0 the DNSSEC is enabled, so there was a tiny chance that during update the DNS re-configuration was skipped. &nbsp;</div><div style="color: #333333;"><br /></div><div style="color: #333333;">Unfortunately to run <i><b>ipa-dns-install</b> </i>script you need to bring up the LDAP and Kerberos services. Luckily <i>ipactl</i> correctly bring up this service with foce parameter (<b><i>ipactl start -f</i></b>). After that the ipa-dns-install script overwrite the current named.conf, created missing tokens and after that the named-pkcs11 started correctly.&nbsp;</div><div style="color: #333333;"><br /></div><div style="color: #333333;">After a few hours digging in the logs files I realized that I'm using a custom named.conf with additional views and the upgrade script skipped named.conf file update (<span style="font-family: 'Courier New', Courier, monospace; font-size: xx-small; line-height: 20px; white-space: pre-wrap;">INFO DNS is not configured)</span>&nbsp;. At <span style="font-family: inherit;">the end you need to add your custom ACL and Zones sections to named.conf&nbsp;</span></div><div style="color: #333333;"><span style="font-family: inherit;"><br /></span></div><div style="color: #333333;"><span style="font-family: inherit;">So if you have custom bind configuration you need to:</span></div><div><ol><li style="color: #333333;"><span style="color: black; text-align: center;"><span style="font-family: Times, Times New Roman, serif;">Backup current named.conf</span></span></li><li style="color: #333333;"><span style="color: black; text-align: center;"><span style="font-family: Times, Times New Roman, serif;">Update ipa server packages&nbsp;<i>yum update freeipa-server</i></span></span></li><li style="color: #333333;"><span style="color: black; text-align: center;"><span style="font-family: Times, Times New Roman, serif;">Use the force switch in<i> ipactl start -f</i></span></span></li><li style="color: #333333;"><span style="color: black; text-align: center;"><span style="font-family: Times, Times New Roman, serif;">Run&nbsp;<i>ipa-dns-install </i>or manually reconfigure<i> bind-pkcs11&nbsp;</i></span></span></li><li style="text-align: justify;"><span style="font-family: Times, Times New Roman, serif;">Add your missing zones to <i>named.conf</i></span></li><li style="text-align: justify;"><span style="font-family: Times, Times New Roman, serif;">Start ipa services.</span></li></ol></div><span style="color: #333333;"></span><br /><div><span style="color: #333333;"><br /></span></div><span style="color: #333333;"></span></div></div>